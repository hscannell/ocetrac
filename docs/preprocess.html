---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "notebooks/marine_heatwaves/00_preprocess.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/marine_heatwaves/00_preprocess.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Preprocess-Gridded-Data-to-find-Anomalies-and-Extreme-Values">Preprocess Gridded Data to find Anomalies and Extreme Values<a class="anchor-link" href="#Preprocess-Gridded-Data-to-find-Anomalies-and-Extreme-Values"> </a></h3><p>This notebook provides an example of how one might preprocess gridded sea surface temperature (SST) data to extract anomalies and detect extreme values. Here we will use monthly mean SST from the <a href="https://www.ncdc.noaa.gov/oisst/data-access">NOAA Optimum Interpolation Sea Surface Temperature</a> (OISST v2.1) dataset. This data is measured from a blend of satellite and in-situ observations. We elect to use data from AVHRR-only satellites. This product is available from September 1981 through present on a 1/4º global regular grid.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-Import-data">1. Import data<a class="anchor-link" href="#1.-Import-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/glade/scratch/scanh/OISST/&#39;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;avhrr-only-v2.*.nc&#39;</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>

<span class="c1"># calculate monthly mean sst</span>
<span class="n">mnsst</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mnsst</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;sst&#x27; (time: 464, lat: 720, lon: 1440)&gt;
array([[[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [-1.3066666, -1.3066666, -1.3073334, ..., -1.3066666,
         -1.3066666, -1.3063333],
        [-1.3096668, -1.3099998, -1.3099998, ..., -1.3093333,
         -1.3093333, -1.3096668],
        [-1.312    , -1.312    , -1.312    , ..., -1.312    ,
         -1.312    , -1.312    ]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
...
        [-1.7780645, -1.7780645, -1.7780645, ..., -1.778387 ,
         -1.778387 , -1.778387 ],
        [-1.778387 , -1.778387 , -1.778387 , ..., -1.778387 ,
         -1.778387 , -1.778387 ],
        [-1.778387 , -1.778387 , -1.778387 , ..., -1.778387 ,
         -1.778387 , -1.778387 ]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [-1.7738461, -1.7738461, -1.7738461, ..., -1.7738461,
         -1.7738461, -1.7738461],
        [-1.7746152, -1.7746152, -1.7746152, ..., -1.7746152,
         -1.7746152, -1.7746152],
        [-1.7749999, -1.7749999, -1.7749999, ..., -1.7749999,
         -1.7749999, -1.7749999]]], dtype=float32)
Coordinates:
  * time     (time) datetime64[ns] 1981-09-01 1981-10-01 ... 2020-04-01
    zlev     float32 0.0
  * lat      (lat) float32 -89.875 -89.625 -89.375 ... 89.375 89.625 89.875
  * lon      (lon) float32 0.125 0.375 0.625 0.875 ... 359.375 359.625 359.875</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'sst'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 464</li><li><span class='xr-has-index'>lat</span>: 720</li><li><span class='xr-has-index'>lon</span>: 1440</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-b9a70328-e31f-427d-ba76-0fbffda8670f' class='xr-array-in' type='checkbox' checked><label for='section-b9a70328-e31f-427d-ba76-0fbffda8670f' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan nan nan nan ... -1.7749999 -1.7749999 -1.7749999 -1.7749999</span></div><div class='xr-array-data'><pre>array([[[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [-1.3066666, -1.3066666, -1.3073334, ..., -1.3066666,
         -1.3066666, -1.3063333],
        [-1.3096668, -1.3099998, -1.3099998, ..., -1.3093333,
         -1.3093333, -1.3096668],
        [-1.312    , -1.312    , -1.312    , ..., -1.312    ,
         -1.312    , -1.312    ]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
...
        [-1.7780645, -1.7780645, -1.7780645, ..., -1.778387 ,
         -1.778387 , -1.778387 ],
        [-1.778387 , -1.778387 , -1.778387 , ..., -1.778387 ,
         -1.778387 , -1.778387 ],
        [-1.778387 , -1.778387 , -1.778387 , ..., -1.778387 ,
         -1.778387 , -1.778387 ]],

       [[       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        [       nan,        nan,        nan, ...,        nan,
                nan,        nan],
        ...,
        [-1.7738461, -1.7738461, -1.7738461, ..., -1.7738461,
         -1.7738461, -1.7738461],
        [-1.7746152, -1.7746152, -1.7746152, ..., -1.7746152,
         -1.7746152, -1.7746152],
        [-1.7749999, -1.7749999, -1.7749999, ..., -1.7749999,
         -1.7749999, -1.7749999]]], dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-2015f313-ec86-46cf-91de-7668778732ec' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2015f313-ec86-46cf-91de-7668778732ec' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1981-09-01 ... 2020-04-01</div><input id='attrs-5337d6d1-51c2-4fbd-b838-a07291dc0e4a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5337d6d1-51c2-4fbd-b838-a07291dc0e4a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c5ad703d-8e51-4060-abec-02b1fc8e23d9' class='xr-var-data-in' type='checkbox'><label for='data-c5ad703d-8e51-4060-abec-02b1fc8e23d9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;1981-09-01T00:00:00.000000000&#x27;, &#x27;1981-10-01T00:00:00.000000000&#x27;,
       &#x27;1981-11-01T00:00:00.000000000&#x27;, ..., &#x27;2020-02-01T00:00:00.000000000&#x27;,
       &#x27;2020-03-01T00:00:00.000000000&#x27;, &#x27;2020-04-01T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>zlev</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0</div><input id='attrs-ab1d04f0-19fe-427e-a36d-bf032f34ac02' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ab1d04f0-19fe-427e-a36d-bf032f34ac02' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8f4cefc5-3ee4-44e5-a93f-6ac664301d22' class='xr-var-data-in' type='checkbox'><label for='data-8f4cefc5-3ee4-44e5-a93f-6ac664301d22' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Sea surface height</dd><dt><span>units :</span></dt><dd>meters</dd><dt><span>actual_range :</span></dt><dd>0, 0</dd></dl></div><div class='xr-var-data'><pre>array(0., dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-89.875 -89.625 ... 89.625 89.875</div><input id='attrs-48842ff6-5819-4556-b9a8-92ea0c57e640' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-48842ff6-5819-4556-b9a8-92ea0c57e640' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6cdbb5a1-23f3-48a9-b3cb-41c7dd541e43' class='xr-var-data-in' type='checkbox'><label for='data-6cdbb5a1-23f3-48a9-b3cb-41c7dd541e43' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>grids :</span></dt><dd>Uniform grid from -89.875 to 89.875 by 0.25</dd></dl></div><div class='xr-var-data'><pre>array([-89.875, -89.625, -89.375, ...,  89.375,  89.625,  89.875],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.125 0.375 ... 359.625 359.875</div><input id='attrs-c6754206-4273-49ad-8c2a-c0a26167fb27' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c6754206-4273-49ad-8c2a-c0a26167fb27' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d04e6644-9d49-4c6b-b908-2ae0731ca3e1' class='xr-var-data-in' type='checkbox'><label for='data-d04e6644-9d49-4c6b-b908-2ae0731ca3e1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>grids :</span></dt><dd>Uniform grid from 0.125 to 359.875 by 0.25</dd></dl></div><div class='xr-var-data'><pre>array([1.25000e-01, 3.75000e-01, 6.25000e-01, ..., 3.59375e+02, 3.59625e+02,
       3.59875e+02], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c1d24935-9f8d-4ef4-a900-3d6fd60420cf' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c1d24935-9f8d-4ef4-a900-3d6fd60420cf' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dm</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;lsmask.nc&#39;</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">reproject</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">))</span>
<span class="n">land_mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">reproject</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">dm</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">dm</span><span class="o">.</span><span class="n">lon</span><span class="p">})</span>  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">land_mask</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.colorbar.Colorbar at 0x2b9bbe714520&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWYAAAD8CAYAAABErA6HAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjMuMywgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy/Il7ecAAAACXBIWXMAAAsTAAALEwEAmpwYAAAiq0lEQVR4nO3df/AkdZ3f8efLRUQQDnCBWhYIq1m0VgKKe2jOi6eix2Is16s6k8Wc7hkuW1yBP65iKcQqvasrUtx55/0oRWqjGzDx2GwUj82FuCI5QlIn8kMBWVbYDRhYdsMK3KnROmC/33f+6P7C7DA/ema6pz/d/Xp8q+s709PT/Zn+8Z7PfH61IgIzM0vHi+pOgJmZHcqB2cwsMQ7MZmaJcWA2M0uMA7OZWWIcmM3MEjM2MEvaIumApPt65r1W0m2S7pZ0p6Rze167XNIeSQ9IOr+qhJuZpWBQjOx7XZL+PI+L90o6Z9w6i+SYrwHW9c37Q+D3IuK1wKfy50haA2wAXpO/5ypJywpsw8ysqa7hhTGy1wXA6nzaBHxh3ArHBuaIuBV4qn82cEz++BeAffnj9cDWiHg6Ih4G9gDnYmbWUkNiZK/1wJcjcxtwrKQVo9Z52JRp+SiwQ9IfkQX3X8rnrwRu61lubz7vBSRtIvv24Kgj9fpX/8PDp0yKmXXJXfc+/UREnDDLOs5/61Hx5FMLRbe3E/j7nlmbI2LzBJtbCTza83wpLu4f9oZpA/NvA78TEV+T9M+ALwFvBzRg2YF9vvMPthlg7dlHxO07TpsyKWbWJctW7P4/s67jyacWKBpzlq3Y/fcRsXaGzRWOi0umbZWxEbg+f/yfeb64Yi9was9yp/B8MYeZWRICWCz4V4KJ4+K0gXkf8Cv547cBu/PH24ENkl4iaRVZYfftU27DzKwSQfBsLBSaSrAd+EDeOuONwI8jYmgxBhQoypB0HfAWYLmkvcCngX8F/Jmkw8jKXjYBRMROSduA+4GDwCUR5XwyM7MylZQbHhYjXwwQEVcDNwLvJGsM8XPgg+PWOTYwR8SFQ156/ZDlrwCuGLdeM7O6BMFCSUMej4iRS68HcMkk65y28s/MrNEWR9e/1cqB2cw6J4AFB2Yzs7Q4x2xmlTj/5LMLLbdj3z1z21aVaShLAM8mfFs9B2Yz65wgXJRhZrOZNbd6/slnD8yxzrreIlLKKT8nYCHduOzAnKreCybJE9sqMyxYDjsPxgXX/vfNIxgX3V5d53bW8y9djQnMgw7u0kFtYxDr/WzDcjvWTr3HetB5P2kgTlW96RQLA4ewSENjAvMoTTkRpzEst9Pmz2zTq6u4YlJ1n79Z5Z8D88z6cxF1H9i6dPVzd1mRY+7zYjJZO2YHZjOzpCw6x1yu1HIH8y5eaGOZug026Pj6mM/OOeaWGRQUq7hQipYL9i/ni9b6FTknUiyHrlIgFqYe9bh6DswFVZ1L7dqFYWkZ1MKpyu2kwEUZLZHSSWXpGNWUc9Z1+pyrRiCeiWV1J2OoIgPlbwHeBRyIiDN75n8IuJRsQPz/GhEfz+dfDlwELAAfjogdVSR8Xqa5QIq0GqkqZzLNen3xT2/QL6lxbc8HvTboPBvUnnnHvnsaWceQWjqzDibNLsq4Bvgc8OWlGZLeSnZL7rMi4mlJJ+bz1wAbgNcAJwPfknSG72JiZqlpdOVfRNwq6fS+2b8NXBkRT+fLHMjnrwe25vMflrSH7Eat3y4vyWkbl2NtalnypN2Eu2JYq4mlXPMw/bnmovuxf51lH5dxvQ5nXWcqIsRCNDvHPMgZwD+RdAXZPf8+FhF3ACuB23qW25vPa6xJizAmmZ+KWdKX4jgIUH9rlVkq05be0xu8Jw2YLqMeb7HJOeYR7zsOeCPwi8A2Sa+AgZ904BhOkjaR38T1tJXTJSO1oNBf/td105S1l1VpVnR+0W2Xlc4ye/EVGdTIAXqwrPIv3bYP06ZsL3B9fpPB2yUtAsvz+af2LHcKsG/QCiJiM7AZYO3ZR0w0AN8kOYZ+ZZ2g42riu9xtvNekX1TTVGyV9WU4yXqKBvpZzoFpg+qwDMI8zsmmnPNtqPwb5C+BtwG3SDoDOBx4AtgO/IWkz5JV/q0Gbi8hnc8pY1zaJZPkkMpctxVTdH/Oqw1uWYa15Bj0fNBrvfOH7Zf+4NxbPDJoXcPSN4mmnfMLTW7HLOk64C3Ackl7gU8DW4Atku4DngE25rnnnZK2AfeTNaO7xC0yzCw1qff8UyRw36u1Zx8Rt+84bexyZeeIqqiBtupVkdtrijKLd6YdeH+SdVVh2Yrdd0XE2lnW8cp/dFT826+vKbTshtV3zry9SaVb+t2nSJnxpJWBbb+Im25YB4t+XTmOswS/Sd5bpBK77EraeReDZIMYpZtjbkxgnpUr45pj0hHVuhaspylznrQicVRwLqNCs6z1TSsQzza5S3bdiuaCZ2mpYZay/sA1qsKv/3Fq53wqmaMIWtnBZC6KfmOndvLZ9Ka9cNt4DpQRxHpzvmU1u2sHtbKDiZlZYwXOMU+svd/S3TBpbX9Vvf26Zli771krDdu6f135V7GuVf6kbFwQqKKMsWjwGPWzPrXzpcwvq1nXlUq5cJkCeaD8WbT5G7tpxrUfHjf+cJUX+LiK4HG3AXOb9m4J4NkWjpVRqaVg3HsxudVFfWYZeKeOZoqzBtnUc9Oz8KBGS9Ts8ZjNzNomgEVX/k3O3+hpaHrztbKbnM1Lmb80UjkWqUk5x5zuV8YExt0twqbT9KDcdEvnddf3ZxWfP0IsxosKTeNIWifpAUl7JF024PVfkPRfJN0jaaekD45bZ9KBub9mueoKJHue9/Oh6t4fZQfpJgX7Kn6xZJV/ywpNo0haBnweuABYA1yY3/u01yXA/RFxNtlInX8s6fBR6006ME9yhwZLU90BrUypfJZBAXra8cNTvn6qTVt2z78i0xjnAnsi4qGIeAbYSnbv014BHC1JwMuAp8iGRR4q2TLmJU29j17TlVHGmUogK1Mbm2+mOMDXoDSVmc6s8q9wGfNySXf2PN+c34EJsnuaPtrz2l7gDX3v/xzZTUT2AUcD/zwiFkdtMPnAbGZWhQl6/j0xYjzmIvc5PR+4m+yuT68EbpL0PyPiJ8M2WOQOJluAdwEHIuLMvtc+BnwGOCEinsjnXQ5cBCwAH46IHeO28eC9Rx76KVqWI2mqacfMTS331VbTtPVvuuwz7p55PSX2/Ctyn9MPAlfmd3naI+lh4NWMuO1eka+Ma4B1/TMlnQq8A3ikZ94aYAPwmvw9V+WF4yOdcdbPCyTD6uJAe6gU98csQTnFz1N0qNNZLPKiQtMYdwCrJa3KK/Q2kBVb9HoEOA9A0knAq4CHRq10bI45Im6VdPqAl/4E+DhwQ8+89cDWiHgaeFjSHrLC8W+P204Xvu2tPVIZ73iS7acYgCexlP5lK2ZfVwQ8uzh724eIOCjpUmAHsAzYEhE7JV2cv3418PvANZK+T1b08YmlEoZhpipjlvRu4LGIuCeraHzOSuC2nud783mD1rEJ2ARw2srDOG6ahNjcNP2irkpXihDaJivKKKdRWkTcCNzYN+/qnsf7gF+dZJ0TB2ZJRwKfHLKhIgXh2cysVnMzwDE6PhLuhGNWuzIGWSrz1lN1KauMGdLu+TdNjvmVwCpgKbd8CvBdSedSrCDczKxWEzaXm7uJA3NEfB84cem5pB8CayPiCUnbgb+Q9FngZGA1I2oeLX2p56DqNo9ijEEVYWVvtwnHudzPXF5RRhXGpkzSdWSVd6+StFfSRcOWjYidwDbgfuAbwCURsVBWYifV34W7aJfu3u7fTThhq9Llz566Lh6bsj/zYn7fv3FTHYq0yrhwzOun9z2/ArhitmS90KS14NMexC6e8Ja2YeW/qbQMaaKsVcbYlry1STcvz+AgOU3gHJRzLqqrJ32bB4tvukk7/vjX3wstdTApMtUhqS7ZwwJxFUHBzZyGa3rNfRcNyz37WA1XVzFFEUkFZjOzeWhdq4w6DLoH4JJZu6I615yp4+7WNr3+NsltPI+r/kwpt8pIJjAXCQzT/pSe5H39J3wXKlgcdJthkiFwfUxHixAHHZhHKzqI0agc7qDcQxmDibfFLGWQKY7Xa90+n8vgoowSFQ0QZZ60Tb8AhrVIafrnSkFKxWFt+vIclQErZRAjHJgr1aaT0cwy8/jCc2A2M0tIiQPlVyLd0u8ZOBdd3LhcSSo/01Pm820+3CW7JmXWLveXpU7SuqK3FUcbAtO0lXfuUGJ1qvK8i4CDJQyUX5UkUvbgvUdWejfsaQ9wG4LytByUJ+P91Dzukj0Dn/CzG7YPR+1b7/fJteUXVkoG78+kbsZaieQDs5lZFcKB2erkDiLzU0dP0bYe28qbyyU8iFGRgfK3SDog6b6eeZ+R9ANJ90r6uqRje167XNIeSQ9IOn/WBJ5/8tnPTaNeL7qururyZ28zB+XpRKRdxlyk8u8aYF3fvJuAMyPiLOBB4HIASWuADcBr8vdcJam00ahHHSwHHkuNx0BOmVhYfFGhqQ5F7mByq6TT++Z9s+fpbcCv54/XA1sj4mngYUl7gHPJbk1VilGtBRych3OAaDZ3pS9f28uY/yXwn/LHK8kC9ZK9+bwXkLQJ2ARwBEdOvNEqT842jijncub56h+qdpr3j3utTednr3l8rlaPlSHpk8BB4CtLswYsFoPeGxGbgc0Ax+j4gcuYmVUisnLmVE0dmCVtBN4FnBfx3EfcC5zas9gpwL7pk1eOtucwLE29ueYqbiLcxl9A87xGG90qYxBJ64BPAO+OiN7BlLcDGyS9RNIqYDVw++zJLMekJ3KbTvw2fZYm8v4fb55BORKv/CvSXO46ssq7V0naK+ki4HPA0cBNku6WdDVAROwEtgH3A98ALomIhcpSX9CkB7x3+TbcYbjJaW+6ae/OXpR/BU4vothUhyKtMi4cMPtLI5a/ArhilkSlalDNuGvLrU5t+dKt49pJuVVGEoMYzcOkg/KMO1Ganou2evicSUOWG1ahqQ7ukm1mndTa5nJNVbSWfNLxoVMbXcy5szSldp7Ura59kXJzuc4UZUA5J0CRIo5ZlBFMXcySvrKOjwP8dAKxuPiiQlMdOpljTlEVPcSs/Xrb6DfxXKjziyXhDHO3csy9qgyEk+ZY+5dt4gVm1SryS22SkRZTUdu5XmLln6R1+WiaeyRdNmSZt+RNi3dK+h/j1ukc8wSqOIlG3V2kaReZ1Wtcc07rU0KWOR898/PAO8h6Pt8haXtE3N+zzLHAVcC6iHhE0onj1tvZHLOZdVtJOeZzgT0R8VBEPANsJRtls9f7gOsj4pFsu3Fg3Eo7HZjrHpdg3Dqd22m3okPXzvLLyb+6BgtgcVGFJmC5pDt7pk09q1oJPNrzfNCImmcAx0m6RdJdkj4wLn2dK8ro/4lXV5FBHUG3qRVEbTZogK1Jm2mOWq8NEUDxdsxPRMTaIa8VGVHzMOD1wHnAS4FvS7otIh4ctsHOBeZJzXKCDwv60+TUnfNpNx/n+SupHXORETX3kgX3nwE/k3QrcDbZ3Z8GcmAeoY7ii0kVzQU7t9wMw8Ze6Q/YPpYlKCcw3wGszkfTfIzs1nrv61vmBuBzkg4DDgfeAPzJqJV2tox5VM6kzA4a87iAiuSyfCE3TxeOWX2/EIpV/I2r/IuIg8ClwA5gF7AtInZKuljSxfkyu8hG27yXbBjkL0bEfcPWCc4xm1lXldTDJCJuBG7sm3d13/PPAJ8pus5OB+aln/ddyJlYM/Wfm20rg66tvX5ALKY7iFGRgfK3SDog6b6eecdLuknS7vz/cT2vXZ73gHlA0vlVJbwsTTrR/SViPv5lUsFp/oqUMV8DrOubdxlwc0SsBm7OnyNpDVnh92vy91yV94yxGfmCtEk0LcNRiyg41aDIHUxulXR63+z1wFvyx9cCt5DdA3A9sDUingYelrSHrGfMt0tKbyWG3TAz1WDY9IFrrFpL53H/LdKsT8KjGE1bxnxSROwHiIj9PX2/VwK39Sw3qBcMAHnvmU0AR3DklMkoT5U5DI97YWWaJsiW0WmlSnO/RibrYDJ3ZVf+FekFk82M2AxsBjhGxyf83WVmbdTGgfIfl7QCIP+/NChHkV4wjVBV55IycwWzpNE5+HbycZ3AoopNNZg2MG8HNuaPN5L1bFmav0HSS/KeMKvJGlQ3ShN6/M3CF287TXpcUxu/ed7XiKLYVIexRRmSriOr6FsuaS/waeBKYJuki4BHgPcC5D1etgH3AweBSyJioUhChnVFtWqk9EVhNnc1trgookirjAuHvHTekOWvAK6YJBFnnPXzSRZvtFkD4iQtMYYNlu6gbL1Sar0xbjCnHfvuYdmKMrakTlX+mZk1Q5NzzHVwscbzpr1FUNf3m00nlVtSzWX7i9VvYlqdHV1umLpPyH6zpie1z2PN0Pov9qV2zEWmGjgw90g1iPU2sxuXxv6a9tZfYGZTSrlVhgNzLtWg3GtUkHUA7jYf/ykkPFaGAzPNCMpLJg3OTfpsNh0H5fZJsvLPzKxqdRVTFNH5HHNTcpTj0tmUz2HN0eqceNDKLtmt0LRgNumdlCdtdphaF10br+rj1epzwmXMVrZJLpZB4/MO0n+HlNZekC0yr8xFG8+FlFtlJF/G7LGMD9W7P/q7Z48KqpPuRw+2bv1aV7nsMubZtH20tyoMCtiTfOZBy7b6Z21D+XjMIOGijORzzGZmZauzmKIIB+YGmldu38VINk4qY2tMpaYWF0U0oijDhqsjcDpYpyOVgNjEcyLlyr+ZArOk35G0U9J9kq6TdISk4yXdJGl3/v+4shJrL9Rf4Vf1BZJKILDn+ZhMKeEy5qkDs6SVwIeBtRFxJrAM2ABcBtwcEauBm/PnNgf9zd3KXmfv/ybmkMyeUzC33MgcM1kZ9UslHQYcSXbj1fXAtfnr1wLvmXEbloBBd0FxcE5H3bnmurc/lTbmmCPiMeCPyO75tx/4cUR8EzgpIvbny+wHThz0fkmbJN0p6c4fPVnotoBmZqXRYrGpDrMUZRxHljteBZwMHCXpN4q+PyI2R8TaiFh7wsuXjV2+7G9k5/Zm18hckpXO50H5ZinKeDvwcET8KCKeBa4Hfgl4XNIKgPz/gdmTaXXzF5kN0uig3MaiDLIijDdKOlKSyO6avQvYDmzMl9kI3DBbEm2e3LuvuRodJOct8cq/qTuYRMR3JH0V+C5wEPgesBl4GbBN0kVkwfu9ZSR0nsGifwyKLnAwts5JuOffTK0yIuLTEfHqiDgzIt4fEU9HxJMRcV5ErM7/P1VWYq1ckwZjB29rlYSLMtwl28w6R9TX4qIId8nu05VcYe+wntMMB2ppqqKTUSuVWMYsaZ2kByTtkTS0Q52kX5S0IOnXx62zs4G5/+R1pdehvC+azcG5gBKKMiQtAz4PXACsAS6UtGbIcn8A7CiStM4F5iI5ijaf1JN8ATk4N1ubz+NSlFPGfC6wJyIeiohngK1k/Tv6fQj4GgWbD3cuMNtk/Eui2aoMzk0P/BMUZSxf6qWcT5t6VrMSeLTn+d583vPbycYV+jXg6qJpc+WfmXVT8RYXT0TE2iGvDRrUuX/Nfwp8IiIWsi4f43UqMDf9Gz4VXWznbS0TpbXK2Auc2vP8FLLB3HqtBbbmQXk58E5JByPiL4ettDGBedbRzLocSKooinBw7rZWHPty2ijfAayWtAp4jGzo4/cdspmIVUuPJV0D/NWooAwdKmPuYjlp1eXDXdyn1h5lNJeLiIPApWStLXYB2yJip6SLJV08bdoak2MGjwE8Ce8nq0orcstQWq++iLgRuLFv3sCKvoj4zSLrbFRgnofWnHRz4iKNbmjdMa6xu3URDsxm1jmivpHjiuhMGbNVx8Um7da63HKulcN+NkmRE6utJ9+8uEijnVp9TBPOMXciMJuZvUDCgXmmogxJx0r6qqQfSNol6R9LOl7STZJ25/+PKyux0PJvcLOSuZhpiMTvYDJrGfOfAd+IiFcDZ5O147sMuDkiVgM358/NzNKS8ED5s9wl+xjgzcCXACLimYj4O7KRla7NF7sWeM9sSTQzK58Wi011mCXH/ArgR8C/l/Q9SV+UdBRwUkTsB8j/nzjozZI2LY3W9KMnF2ZIxmgu+jCbTtuvnbYWZRwGnAN8ISJeB/yMCYotImJzRKyNiLUnvHzZRBsuesK0/cQysykVLcZoYGDeC+yNiO/kz79KFqgfl7QCIP9faGDosnU9KE/y+X07IuvXifMh4cA8dXO5iPi/kh6V9KqIeAA4D7g/nzYCV+b/byglpX08bsZsBl14S/Om2a+duJA7ogvHMvWef7O2Y/4Q8BVJhwMPAR8ky4Vvk3QR8Ajw3hm3MZEunFSzKnsfeZ+3R5eOpRbTjcwzBeaIuJtsEOh+582yXjOzSnkQo+p06dt9FpPup97lXVzUXD52o7W5KMMSNo8vLn85tkMnj2PCgdmjy9lInbxgW8C55fHa2o7ZOsLB2Vqpjc3lrFuWmidWGaSXcnn+IpivTu7v8u6SXQkHZjPrnLa3Y7YO6WTOqqV8LIFINzI7MFsyHCxsnlLOMbvyzyZ2/slnl1rr7xYE5Rv2JedxUXKJD2LkHLOZdZIr/8zMEuPAbK1S1k9hN4+rjouHxghc+WfWz0HZ6pZy5Z8Ds82dg/L8eV8P4MBs9jwHCatb6h1MZm4uJ2lZfjPWv8qfHy/pJkm78//HzZ5MM5tF2U0cGy8CLRab6lBGO+aPALt6nl8G3BwRq4GbmeAGrWZmc5NwO+aZArOkU4B/CnyxZ/Z64Nr88bXAe2bZhpmVw0VIh0p52M9Zy5j/FPg4cHTPvJMiYj9AROyXdOKgN0raBGwCOG2li7rNquSg3CeAhO/5N3WOWdK7gAMRcdc074+IzRGxNiLWnvDyZdMmw8zGcFAeoqVFGW8C3i3ph8BW4G2S/iPwuKQVAPn/AzOn0sysZGUVZUhaJ+kBSXskvaBOTdK/kHRvPv2NpLG1sFMH5oi4PCJOiYjTgQ3Af4+I3wC2AxvzxTYCN0y7DTObjXPLw5XRKkPSMuDzwAXAGuBCSWv6FnsY+JWIOAv4fWDzuLRVMbrclcA7JO0G3pE/NzNLR3mjy50L7ImIhyLiGbLSg/WHbCribyLib/OntwGnjFtpKbVuEXELcEv++EngvDLWa2bT6c0pV31LsCbKOpgULkBeLunOnuebI2Ip17sSeLTntb3AG0as6yLgv43boJtDmHWAg/MAxUeXeyIi1g55TQPmDYz4kt5KFph/edwGHZjNWs4BebAJcsyj7AVO7Xl+CrDvBduSziLr73FBXqowku9gYmbdU14Z8x3AakmrJB1O1hBie+8Ckk4DrgfeHxEPFkmec8xm1kHljIMREQclXQrsAJYBWyJip6SL89evBj4FvBy4ShLAwRFFI4ADs5l1VUkD5UfEjcCNffOu7nn8W8BvTbJOB2Yz657wraXMzNLjW0uZmSUm3bjswGxm3aTFdMsyHJjNrHuCSTqYzJ0Ds5l1joiyOphUwoHZzLop4cDsnn9mHdX5m7NGFJtq4ByzWccsBeROj6HhMubm6s1R1HUS919Eo9I0S3r7c0+dvmhbrPO55B4pt8qY5Z5/p0r6a0m7JO2U9JF8/vGSbpK0O/9/XHnJNTMrQ8FijAYWZRwE/nVEfFfS0cBdkm4CfhO4OSKuzO9/dRnwidmTOl/9OYsqfv5NknsZtOyo98+aMxr1fuemrfGCpCv/pg7MEbEf2J8//qmkXWSj+a8H3pIvdi3ZnU2SDsyzBshe44JWG35KuoyyHTo/eH66JRnllDFLOh14HfAd4KQ8aBMR+yWdWMY2ZjEskFQRJIed7G0IyP2cq05f7/noeoRDtbods6SXAV8DPhoRP8nHGy3yvk3AJoDTVk6WjKIVYKPeV6U2BuFJpVBxajZSWwOzpBeTBeWvRMT1+ezHJa3Ic8srgAOD3pvfzHAzwDE6PqYNZg6C6Rt0jBysq9e2a+P5z7N79pVFwEK6ZRmztMoQ8CVgV0R8tuel7cDG/PFG4Ibpk2dmVpGWtsp4E/B+4PuS7s7n/RvgSmCbpIuAR4D3zpRCa6XOVzz1qOoXRRP371xz+W0syoiI/8XgW3cDnDfteq3dmhgs6lB2sE6xWKPWNAVQwj3/quKefzYXbQrIkwaUHfvuKaUyNMXgOq36P0tApFvG7MBslWtaUC47aAzrrNQ1SX3uIOnKPwdm65SkgkPN5tVaJtl93sYyZjOzRnNgti7rb4FRR06tacUpdSmjd2CyOeRD1NcUrggHZpuLcRdr1RdzM4JFelq73wJIeNhPB2Yz6ybnmM3MUpJ2l2wHZjPrnoBwO2Yzs8S455+ZWWJcxmxmlpAIt8owM0uOc8xmZikJYmGh7kQM5cBsZt3jYT/NzBKUcHO5qW8tNY6kdZIekLRH0mVVbcfMbFIBxGIUmsYZF+uU+fP89XslnTNunZUEZknLgM8DFwBrgAslraliW2ZmE4t8oPwi0wgFY90FwOp82gR8YVzyqsoxnwvsiYiHIuIZYCuwvqJtmZlNLBYWCk1jFIl164EvR+Y24FhJK0attKoy5pXAoz3P9wJv6F1A0iaybw+Ap78VX72vorTMYjnwRN2J6OM0FeM0FZdiukal6R/MuvKf8rc7vhVfXV5w8SMk3dnzfHNEbM4fj411Q5ZZCewftsGqAvOgm7QeUliTf7DNAJLujIi1FaVlaimmy2kqxmkqLsV0VZ2miFhX0qrGxrqCyxyiqqKMvcCpPc9PAfZVtC0zs7oUiXUTx8OqAvMdwGpJqyQdDmwAtle0LTOzuhSJdduBD+StM94I/DgihhZjQEVFGRFxUNKlwA5gGbAlInaOeMvmEa/VKcV0OU3FOE3FpZiuFNP0AsNinaSL89evBm4E3gnsAX4OfHDcehUJ9xc3M+uiyjqYmJnZdByYzcwSU3tgTqXrtqQfSvq+pLuX2ixKOl7STZJ25/+PqzgNWyQdkHRfz7yhaZB0eb7fHpB0/hzT9LuSHsv31d2S3jnnNJ0q6a8l7ZK0U9JH8vl176th6aptf0k6QtLtku7J0/R7+fza9tWINNV6XiUlImqbyArL/zfwCuBw4B5gTU1p+SGwvG/eHwKX5Y8vA/6g4jS8GTgHuG9cGsi6f94DvARYle/HZXNK0+8CHxuw7LzStAI4J398NPBgvu2699WwdNW2v8ja0L4sf/xi4DvAG+vcVyPSVOt5ldJUd4459a7b64Fr88fXAu+pcmMRcSvwVME0rAe2RsTTEfEwWY3vuXNK0zDzStP+iPhu/vinwC6ynlR176th6Rqm8nRF5v/lT1+cT0GN+2pEmoaZy/FLSd2BeVhXxToE8E1Jd+XdxQFOiry9Yf7/xBrSNSwNde+7S/ORsrb0/Ayee5oknQ68jizXlcy+6ksX1Li/JC2TdDdwALgpImrfV0PSBImcV3WrOzBP3FWxQm+KiHPIRoK6RNKba0pHUXXuuy8ArwReS9bf/4/rSJOklwFfAz4aET8ZteiAefNMV637KyIWIuK1ZD3OzpV05ojF60xTEudVCuoOzMl03Y6Iffn/A8DXyX4qPa58FKj8/4EakjYsDbXtu4h4PL+wFoF/x/M/K+eWJkkvJgt+X4mI6/PZte+rQelKYX/l6fg74BZgHQnsq/40pbKfUlB3YE6i67akoyQdvfQY+FXgvjwtG/PFNgI3zDttI9KwHdgg6SWSVpGN9Xr7PBKkQ4cs/DWyfTW3NEkS8CVgV0R8tuelWvfVsHTVub8knSDp2PzxS4G3Az+gxn01LE11n1dJqbv2kayr4oNkNa2frCkNryCr9b0H2LmUDuDlwM3A7vz/8RWn4zqyn3DPkuUSLhqVBuCT+X57ALhgjmn6D8D3gXvJLpoVc07TL5P9lL0XuDuf3pnAvhqWrtr2F3AW8L182/cBnxp3bteYplrPq5Qmd8k2M0tM3UUZZmbWx4HZzCwxDsxmZolxYDYzS4wDs5lZYhyYzcwS48BsZpaY/w9PDGZQ1PzjkAAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">months</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">month</span>
<span class="n">dyr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">months</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">dyr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<span class="n">dyr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dyr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-Fit-mean,-trend,-annual,-and-semi-annual-harmonics-to-SST-over-entire-record&#182;">2. Fit mean, trend, annual, and semi-annual harmonics to SST over entire record&#182;<a class="anchor-link" href="#2.-Fit-mean,-trend,-annual,-and-semi-annual-harmonics-to-SST-over-entire-record&#182;"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dyr</span><span class="p">))]</span> <span class="o">+</span> <span class="p">[</span><span class="n">dyr</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dyr</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dyr</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dyr</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dyr</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dyr</span><span class="p">)])</span>

<span class="c1"># Take the pseudo-inverse of model to &#39;solve&#39; least-squares problem</span>
<span class="n">pmodel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Convert model and pmodel to xaray DataArray</span>
<span class="n">model_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;coeff&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;coeff&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">)})</span> 
<span class="n">pmodel_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pmodel</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;coeff&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;coeff&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>  

<span class="c1"># resulting coefficients of the model</span>
<span class="n">sst_mod</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">pmodel_da</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mnsst</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;coeff&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;coeff&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>  

<span class="c1"># Construction of the mean, trend, and seasonal cycle</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">model_da</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sst_mod</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]),</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>   
<span class="n">trend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">model_da</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sst_mod</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]),</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>    
<span class="n">seas</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">model_da</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sst_mod</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:,:]),</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/glade/u/home/scanh/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/dask/array/numpy_compat.py:41: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-111-2fa376126f41&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span> 
<span class="ansi-green-intense-fg ansi-bold">     11</span> <span class="ansi-red-fg"># resulting coefficients of the model</span>
<span class="ansi-green-fg">---&gt; 12</span><span class="ansi-red-fg"> </span>sst_mod <span class="ansi-blue-fg">=</span> xr<span class="ansi-blue-fg">.</span>DataArray<span class="ansi-blue-fg">(</span>pmodel_da<span class="ansi-blue-fg">.</span>dot<span class="ansi-blue-fg">(</span>mnsst<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> dims<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;coeff&#39;</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">&#39;lat&#39;</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">&#39;lon&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> coords<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#39;coeff&#39;</span><span class="ansi-blue-fg">:</span>np<span class="ansi-blue-fg">.</span>arange<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">7</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;lat&#39;</span><span class="ansi-blue-fg">:</span>mnsst<span class="ansi-blue-fg">.</span>lat<span class="ansi-blue-fg">.</span>values<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;lon&#39;</span><span class="ansi-blue-fg">:</span>mnsst<span class="ansi-blue-fg">.</span>lon<span class="ansi-blue-fg">.</span>values<span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span> 
<span class="ansi-green-intense-fg ansi-bold">     14</span> <span class="ansi-red-fg"># Construction of the mean, trend, and seasonal cycle</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/xarray/core/dataarray.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, data, coords, dims, name, attrs, indexes, fastpath)</span>
<span class="ansi-green-intense-fg ansi-bold">    341</span> 
<span class="ansi-green-intense-fg ansi-bold">    342</span>             data <span class="ansi-blue-fg">=</span> _check_data_shape<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> coords<span class="ansi-blue-fg">,</span> dims<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 343</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> as_compatible_data<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    344</span>             coords<span class="ansi-blue-fg">,</span> dims <span class="ansi-blue-fg">=</span> _infer_coords_and_dims<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">,</span> coords<span class="ansi-blue-fg">,</span> dims<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    345</span>             variable <span class="ansi-blue-fg">=</span> Variable<span class="ansi-blue-fg">(</span>dims<span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">,</span> attrs<span class="ansi-blue-fg">,</span> fastpath<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/xarray/core/variable.py</span> in <span class="ansi-cyan-fg">as_compatible_data</span><span class="ansi-blue-fg">(data, fastpath)</span>
<span class="ansi-green-intense-fg ansi-bold">    215</span> 
<span class="ansi-green-intense-fg ansi-bold">    216</span>     <span class="ansi-red-fg"># we don&#39;t want nested self-described arrays</span>
<span class="ansi-green-fg">--&gt; 217</span><span class="ansi-red-fg">     </span>data <span class="ansi-blue-fg">=</span> getattr<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;values&#34;</span><span class="ansi-blue-fg">,</span> data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    218</span> 
<span class="ansi-green-intense-fg ansi-bold">    219</span>     <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">,</span> np<span class="ansi-blue-fg">.</span>ma<span class="ansi-blue-fg">.</span>MaskedArray<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/xarray/core/dataarray.py</span> in <span class="ansi-cyan-fg">values</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    567</span>     <span class="ansi-green-fg">def</span> values<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> np<span class="ansi-blue-fg">.</span>ndarray<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    568</span>         <span class="ansi-blue-fg">&#34;&#34;&#34;The array&#39;s data as a numpy.ndarray&#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 569</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>variable<span class="ansi-blue-fg">.</span>values
<span class="ansi-green-intense-fg ansi-bold">    570</span> 
<span class="ansi-green-intense-fg ansi-bold">    571</span>     <span class="ansi-blue-fg">@</span>values<span class="ansi-blue-fg">.</span>setter

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/xarray/core/variable.py</span> in <span class="ansi-cyan-fg">values</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    508</span>     <span class="ansi-green-fg">def</span> values<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    509</span>         <span class="ansi-blue-fg">&#34;&#34;&#34;The variable&#39;s data as a numpy.ndarray&#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 510</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _as_array_or_item<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    511</span> 
<span class="ansi-green-intense-fg ansi-bold">    512</span>     <span class="ansi-blue-fg">@</span>values<span class="ansi-blue-fg">.</span>setter

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/xarray/core/variable.py</span> in <span class="ansi-cyan-fg">_as_array_or_item</span><span class="ansi-blue-fg">(data)</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span>         data <span class="ansi-blue-fg">=</span> data<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 272</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>asarray<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    273</span>     <span class="ansi-green-fg">if</span> data<span class="ansi-blue-fg">.</span>ndim <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span>         <span class="ansi-green-fg">if</span> data<span class="ansi-blue-fg">.</span>dtype<span class="ansi-blue-fg">.</span>kind <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#34;M&#34;</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/numpy/core/_asarray.py</span> in <span class="ansi-cyan-fg">asarray</span><span class="ansi-blue-fg">(a, dtype, order)</span>
<span class="ansi-green-intense-fg ansi-bold">     81</span> 
<span class="ansi-green-intense-fg ansi-bold">     82</span>     &#34;&#34;&#34;
<span class="ansi-green-fg">---&gt; 83</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> array<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">,</span> copy<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> order<span class="ansi-blue-fg">=</span>order<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     84</span> 
<span class="ansi-green-intense-fg ansi-bold">     85</span> 

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/dask/array/core.py</span> in <span class="ansi-cyan-fg">__array__</span><span class="ansi-blue-fg">(self, dtype, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1374</span> 
<span class="ansi-green-intense-fg ansi-bold">   1375</span>     <span class="ansi-green-fg">def</span> __array__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1376</span><span class="ansi-red-fg">         </span>x <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>compute<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1377</span>         <span class="ansi-green-fg">if</span> dtype <span class="ansi-green-fg">and</span> x<span class="ansi-blue-fg">.</span>dtype <span class="ansi-blue-fg">!=</span> dtype<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1378</span>             x <span class="ansi-blue-fg">=</span> x<span class="ansi-blue-fg">.</span>astype<span class="ansi-blue-fg">(</span>dtype<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/dask/base.py</span> in <span class="ansi-cyan-fg">compute</span><span class="ansi-blue-fg">(self, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    165</span>         dask<span class="ansi-blue-fg">.</span>base<span class="ansi-blue-fg">.</span>compute
<span class="ansi-green-intense-fg ansi-bold">    166</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 167</span><span class="ansi-red-fg">         </span><span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">=</span> compute<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> traverse<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    168</span>         <span class="ansi-green-fg">return</span> result
<span class="ansi-green-intense-fg ansi-bold">    169</span> 

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/dask/base.py</span> in <span class="ansi-cyan-fg">compute</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    450</span>         postcomputes<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">.</span>__dask_postcompute__<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    451</span> 
<span class="ansi-green-fg">--&gt; 452</span><span class="ansi-red-fg">     </span>results <span class="ansi-blue-fg">=</span> schedule<span class="ansi-blue-fg">(</span>dsk<span class="ansi-blue-fg">,</span> keys<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    453</span>     <span class="ansi-green-fg">return</span> repack<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>f<span class="ansi-blue-fg">(</span>r<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>a<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> r<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> a<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">in</span> zip<span class="ansi-blue-fg">(</span>results<span class="ansi-blue-fg">,</span> postcomputes<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    454</span> 

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/dask/threaded.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(dsk, result, cache, num_workers, pool, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span>                 pools<span class="ansi-blue-fg">[</span>thread<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span>num_workers<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> pool
<span class="ansi-green-intense-fg ansi-bold">     75</span> 
<span class="ansi-green-fg">---&gt; 76</span><span class="ansi-red-fg">     results = get_async(
</span><span class="ansi-green-intense-fg ansi-bold">     77</span>         pool<span class="ansi-blue-fg">.</span>apply_async<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>         len<span class="ansi-blue-fg">(</span>pool<span class="ansi-blue-fg">.</span>_pool<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/dask/local.py</span> in <span class="ansi-cyan-fg">get_async</span><span class="ansi-blue-fg">(apply_async, num_workers, dsk, result, cache, get_id, rerun_exceptions_locally, pack_exception, raise_exception, callbacks, dumps, loads, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    473</span>             <span class="ansi-red-fg"># Main loop, wait on tasks to finish, insert new ones</span>
<span class="ansi-green-intense-fg ansi-bold">    474</span>             <span class="ansi-green-fg">while</span> state<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;waiting&#34;</span><span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">or</span> state<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;ready&#34;</span><span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">or</span> state<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;running&#34;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 475</span><span class="ansi-red-fg">                 </span>key<span class="ansi-blue-fg">,</span> res_info<span class="ansi-blue-fg">,</span> failed <span class="ansi-blue-fg">=</span> queue_get<span class="ansi-blue-fg">(</span>queue<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    476</span>                 <span class="ansi-green-fg">if</span> failed<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    477</span>                     exc<span class="ansi-blue-fg">,</span> tb <span class="ansi-blue-fg">=</span> loads<span class="ansi-blue-fg">(</span>res_info<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/site-packages/dask/local.py</span> in <span class="ansi-cyan-fg">queue_get</span><span class="ansi-blue-fg">(q)</span>
<span class="ansi-green-intense-fg ansi-bold">    131</span> 
<span class="ansi-green-intense-fg ansi-bold">    132</span>     <span class="ansi-green-fg">def</span> queue_get<span class="ansi-blue-fg">(</span>q<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 133</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> q<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span> 
<span class="ansi-green-intense-fg ansi-bold">    135</span> 

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/queue.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(self, block, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    169</span>             <span class="ansi-green-fg">elif</span> timeout <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    170</span>                 <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>_qsize<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 171</span><span class="ansi-red-fg">                     </span>self<span class="ansi-blue-fg">.</span>not_empty<span class="ansi-blue-fg">.</span>wait<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span>             <span class="ansi-green-fg">elif</span> timeout <span class="ansi-blue-fg">&lt;</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    173</span>                 <span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;&#39;timeout&#39; must be a non-negative number&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/envs/ocetrac-2020/lib/python3.9/threading.py</span> in <span class="ansi-cyan-fg">wait</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    310</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>    <span class="ansi-red-fg"># restore state no matter what (e.g., KeyboardInterrupt)</span>
<span class="ansi-green-intense-fg ansi-bold">    311</span>             <span class="ansi-green-fg">if</span> timeout <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 312</span><span class="ansi-red-fg">                 </span>waiter<span class="ansi-blue-fg">.</span>acquire<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    313</span>                 gotit <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">    314</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-Compute-SST-anomalies-(SSTa)-and-detrend">3. Compute SST anomalies (SSTa) and detrend<a class="anchor-link" href="#3.-Compute-SST-anomalies-(SSTa)-and-detrend"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sst_notrend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">((</span><span class="n">mnsst</span><span class="o">-</span><span class="n">trend</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>  
<span class="n">sst_trend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">mnsst</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>  

<span class="c1"># compute anomalies (SSTa) by removing model coefficients – with and without the trend</span>
<span class="n">ssta_notrend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">((</span><span class="n">mnsst</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="n">model_da</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sst_mod</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span> 
<span class="n">ssta_trend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">((</span><span class="n">mnsst</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="n">model_da</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sst_mod</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],:,:]))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="4.-Standardized-SSTa-by-dividing-by-the-monthly-standard-deviation">4. Standardized SSTa by dividing by the monthly standard deviation<a class="anchor-link" href="#4.-Standardized-SSTa-by-dividing-by-the-monthly-standard-deviation"> </a></h3><p>This step places equal variance on SSTa at all spatial points</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stdev_notrend</span> <span class="o">=</span> <span class="n">ssta_notrend</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ssta_notrend</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">stdev_trend</span> <span class="o">=</span> <span class="n">ssta_trend</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ssta_trend</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># Initalize xarray DataArray for SSTa with and without trend</span>
<span class="n">ssta_stn_notrend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ssta_notrend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ssta_notrend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ssta_notrend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> 
<span class="n">ssta_stn_notrend</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ssta_stn_notrend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ssta_stn_notrend</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span> 

<span class="n">ssta_stn_trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ssta_trend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ssta_trend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ssta_trend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> 
<span class="n">ssta_stn_trend</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ssta_stn_trend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ssta_stn_trend</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">mnsst</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">})</span> 

<span class="c1"># Loop over months and divde by standard deviation</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">==</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ssta_stn_notrend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">ssta_notrend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:]</span><span class="o">/</span><span class="n">stdev_notrend</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
    <span class="n">ssta_stn_trend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">ssta_trend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:]</span><span class="o">/</span><span class="n">stdev_trend</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="5.-Define-a-threshold-to-define-extreme-values">5. Define a threshold to define extreme values<a class="anchor-link" href="#5.-Define-a-threshold-to-define-extreme-values"> </a></h3><p>Here we will use the 90th percentile relative to the monthly values over the entire record</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">thresh</span> <span class="o">=</span> <span class="o">.</span><span class="mi">9</span>

<span class="c1"># Compute values of the monthly threshold</span>
<span class="n">prct_notrend</span> <span class="o">=</span> <span class="n">sst_notrend</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sst_notrend</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">prct_trend</span> <span class="o">=</span> <span class="n">sst_trend</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sst_trend</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ssta_prc_notrend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">sst_notrend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sst_notrend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sst_notrend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">prct_notrend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span> 
<span class="n">ssta_prc_notrend</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ssta_prc_notrend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ssta_prc_notrend</span><span class="p">,</span>
                                <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;quantile&#39;</span><span class="p">),</span>
                                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">sst_notrend</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">sst_notrend</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">sst_notrend</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="s1">&#39;quantile&#39;</span><span class="p">:</span><span class="n">thresh</span><span class="p">})</span> 

<span class="n">ssta_prc_trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">sst_trend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sst_trend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sst_trend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">prct_trend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span> 
<span class="n">ssta_prc_trend</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ssta_prc_trend</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ssta_prc_trend</span><span class="p">,</span>
                              <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;quantile&#39;</span><span class="p">),</span>
                              <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">sst_trend</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                      <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">sst_trend</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                      <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">sst_trend</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                      <span class="s1">&#39;quantile&#39;</span><span class="p">:</span><span class="n">thresh</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mnsst</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">==</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ssta_prc_notrend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">sst_notrend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:]</span><span class="o">-</span><span class="n">prct_notrend</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:]</span> 
    <span class="n">ssta_prc_trend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:,:]</span> <span class="o">=</span> <span class="n">sst_trend</span><span class="p">[</span><span class="n">I</span><span class="p">,:,:]</span><span class="o">-</span><span class="n">prct_trend</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="6.-Find-where-the-standardized-SSTa-exceeds-the-threshold">6. Find where the standardized SSTa exceeds the threshold<a class="anchor-link" href="#6.-Find-where-the-standardized-SSTa-exceeds-the-threshold"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mhw_ssta_notrend</span> <span class="o">=</span> <span class="n">ssta_stn_notrend</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ssta_prc_notrend</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">mhw_ssta_trend</span> <span class="o">=</span> <span class="n">ssta_stn_trend</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ssta_prc_trend</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="7.-Save-the-extreme-values-of-SSTa-relative-to-the-mean-in-netCDF-format">7. Save the extreme values of SSTa relative to the mean in netCDF format<a class="anchor-link" href="#7.-Save-the-extreme-values-of-SSTa-relative-to-the-mean-in-netCDF-format"> </a></h3><p>! Need to add land mask to output</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_to</span> <span class="o">=</span> <span class="s1">&#39;/glade/scratch/scanh/MHW_pre/&#39;</span>

<span class="c1"># Convert xarray DatAarray to Dataset</span>
<span class="n">mhw_ssta_notrend</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">mhw_ssta_notrend_ds</span> <span class="o">=</span> <span class="n">mhw_ssta_notrend</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mhw_ssta_notrend&#39;</span><span class="p">)</span>

<span class="n">mhw_ssta_trend</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">mhw_ssta_trend_ds</span> <span class="o">=</span> <span class="n">mhw_ssta_trend</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mhw_ssta_trend&#39;</span><span class="p">)</span>

<span class="c1"># Save Dataset to netCDF</span>
<span class="n">mhw_ssta_notrend_ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">save_to</span><span class="o">+</span><span class="s1">&#39;preprocess_mhw_OISSTv2_monthly_notrend_stn.nc&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">mhw_ssta_notrend_ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.9</span>

<span class="n">mhw_ssta_trend_ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">save_to</span><span class="o">+</span><span class="s1">&#39;preprocess_mhw_OISSTv2_monthly_trend_stn.nc&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">mhw_ssta_trend_ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.9</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

